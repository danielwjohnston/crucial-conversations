<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leadership Bookclub - CHAPTER_TITLE</title>
    <link rel="stylesheet" href="shared.css">
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <div class="timer-progress" id="timerProgress"></div>
    
    <header class="header">
        <div class="slide-counter">
            <span id="currentSlide">1</span> / <span id="totalSlides">TOTAL_SLIDES</span>
        </div>
        <div>Leadership Bookclub - CHAPTER_TITLE</div>
        <button class="auto-advance-toggle" id="autoAdvanceToggle" aria-label="Toggle auto-advance">
            Auto-advance: OFF
        </button>
    </header>

    <div class="persistent-header" id="persistentHeader">
        <h2>CHAPTER_TITLE</h2>
    </div>

    <main class="slideshow-container" id="main-content">
        <!-- SLIDES_PLACEHOLDER -->
    </main>

    <footer class="footer">
        <button class="nav-btn" id="prevBtn" aria-label="Previous slide">Previous</button>
        <button class="nav-btn" id="nextBtn" aria-label="Next slide">Next</button>
    </footer>

    <script>
        let currentSlideIndex = 0;
        let autoAdvanceInterval = null;
        let autoAdvanceEnabled = false;
        const autoAdvanceDelay = 10000; // 10 seconds

        function initSlideshow() {
            const slides = document.querySelectorAll('.slide');
            const totalSlides = slides.length;
            
            document.getElementById('totalSlides').textContent = totalSlides;
            
            // Show first slide
            showSlide(0);
            
            // Set up event listeners
            document.getElementById('prevBtn').addEventListener('click', previousSlide);
            document.getElementById('nextBtn').addEventListener('click', nextSlide);
            document.getElementById('autoAdvanceToggle').addEventListener('click', toggleAutoAdvance);
            
            // Keyboard navigation
            document.addEventListener('keydown', handleKeyPress);
            
            // Update button states
            updateButtonStates();
        }

        function showSlide(index) {
            const slides = document.querySelectorAll('.slide');
            const persistentHeader = document.getElementById('persistentHeader');
            
            if (index >= 0 && index < slides.length) {
                // Hide all slides
                slides.forEach(slide => slide.classList.remove('active'));
                
                // Show current slide
                slides[index].classList.add('active');
                currentSlideIndex = index;
                
                // Update counter
                document.getElementById('currentSlide').textContent = index + 1;
                
                // Show/hide persistent header
                if (index > 0) {
                    persistentHeader.classList.add('show');
                } else {
                    persistentHeader.classList.remove('show');
                }
                
                // Reset and restart timer if auto-advance is enabled
                if (autoAdvanceEnabled) {
                    resetAutoAdvanceTimer();
                }
                
                updateButtonStates();
            }
        }

        function nextSlide() {
            const slides = document.querySelectorAll('.slide');
            if (currentSlideIndex < slides.length - 1) {
                showSlide(currentSlideIndex + 1);
            }
        }

        function previousSlide() {
            if (currentSlideIndex > 0) {
                showSlide(currentSlideIndex - 1);
            }
        }

        function toggleAutoAdvance() {
            autoAdvanceEnabled = !autoAdvanceEnabled;
            const toggle = document.getElementById('autoAdvanceToggle');
            
            if (autoAdvanceEnabled) {
                toggle.classList.add('active');
                toggle.textContent = 'Auto-advance: ON';
                startAutoAdvance();
            } else {
                toggle.classList.remove('active');
                toggle.textContent = 'Auto-advance: OFF';
                stopAutoAdvance();
            }
        }

        function startAutoAdvance() {
            const slides = document.querySelectorAll('.slide');
            if (currentSlideIndex < slides.length - 1) {
                autoAdvanceInterval = setTimeout(() => {
                    nextSlide();
                    if (autoAdvanceEnabled && currentSlideIndex < slides.length - 1) {
                        startAutoAdvance();
                    }
                }, autoAdvanceDelay);
                startTimerProgress();
            }
        }

        function stopAutoAdvance() {
            if (autoAdvanceInterval) {
                clearTimeout(autoAdvanceInterval);
                autoAdvanceInterval = null;
            }
            stopTimerProgress();
        }

        function resetAutoAdvanceTimer() {
            stopAutoAdvance();
            if (autoAdvanceEnabled) {
                startAutoAdvance();
            }
        }

        function startTimerProgress() {
            const progressBar = document.getElementById('timerProgress');
            progressBar.style.transition = `width ${autoAdvanceDelay}ms linear`;
            progressBar.style.width = '100%';
        }

        function stopTimerProgress() {
            const progressBar = document.getElementById('timerProgress');
            progressBar.style.transition = 'none';
            progressBar.style.width = '0%';
        }

        function handleKeyPress(event) {
            switch(event.key) {
                case 'ArrowLeft':
                    previousSlide();
                    break;
                case 'ArrowRight':
                case ' ':
                    event.preventDefault();
                    nextSlide();
                    break;
                case 'Home':
                    showSlide(0);
                    break;
                case 'End':
                    const slides = document.querySelectorAll('.slide');
                    showSlide(slides.length - 1);
                    break;
            }
        }

        function updateButtonStates() {
            const slides = document.querySelectorAll('.slide');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.disabled = currentSlideIndex === 0;
            nextBtn.disabled = currentSlideIndex === slides.length - 1;
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', initSlideshow);
    </script>
</body>
</html>
